<div class='TucanContainer'> 
	<!--<app-loader [isActive]="loading"></app-loader>-->
	<div class="MapContainer">

		<div class="MapSidebar" [ngClass]="{MapSidebarWidthBig: isOpen, MapSidebarWidthSmall: !isOpen}">
			<div class="MapHeaderContainer">
				<h3 class="MapHeaderTitle">{{this.raceName}}</h3>
				<div class="MapHeaderButtonsContainer">
									
				</div>

			</div>
			<div class='MapActionsContainer'>
				<ng-template [ngIf]="this._authService.isLoggedIn() && this.userRegistered" [ngIfElse]="NotLoggedInBlock">
						<button class="whiteButton" (click)="viewAbout()">About</button>
						<button class="whiteButton" *ngIf="this.userRegistered" (click)="openModal('mapSettingsModal')"><span class="material-icons">settings</span></button>
						<app-search [raceID]="raceID"></app-search>
				</ng-template>
				<ng-template #NotLoggedInBlock>
					<button class="whiteButton" (click)="viewAbout()">Join Race</button>
				</ng-template>
			</div>
				
			<div class = "MapFeedContainer">
				<div class = "logActivity" *ngIf="this._authService.isLoggedIn() && this.userRegistered">
					<p>Add your Progress</p>
					<button *ngIf="num_activities>0" matBadge="{{num_activities}}"  matBadgePosition="after" matBadgeColor="accent" (click)="openModal('custom-modal-5')" >Log Activity</button>
					<button *ngIf="num_activities==0" (click)="openModal('custom-modal-5')" >Log Activity</button>
				</div>

				<div class='Slideshow'>
					<div class="SlideshowHeader">
						<button class="SlideshowButton" (click)="SwitchSlideshow('feed')" id="feed-btn">Social</button>
						<button class="SlideshowButton" (click)="SwitchSlideshow('leaderboard')" id="leaderboard-btn">Leaderboard</button>
					</div>
					<div class="SlideshowContents RaceSlideshowContents">
						<div class="SlideshowSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'feed'}">
							<div class="row-status" *ngIf="this._authService.isLoggedIn()">
								<div class="me-col">
									<img width="70px" src="{{userData.profile_url}}">
								</div>
								<div class="story-col">
									<app-story-form  [raceID]="raceID" (logActivityEvent)="logActivity($event)" (storyPostedEvent)="newStoryPosted($event)"></app-story-form>
								</div>
							</div>

							<button class="whiteButton smallButton" (click)="toggleOptions()">{{feedOptions ? 'Hide Options' : 'Show Options'}}</button>
							<div *ngIf="feedOptions">
								Only show people I follow
								<input type="checkbox" [(ngModel)]="followerFeedOnly" [ngModelOptions]="{standalone: true}"/>
								<br>
								Only show stories
								<input type="checkbox" [(ngModel)]="storyFeedOnly" [ngModelOptions]="{standalone: true}"/>
							</div>
							<app-feed [use]="'race'" [ID]="raceID" [hasStoryModalChild]="false" [followOnly]="followerFeedOnly" [storyOnly]="storyFeedOnly" (feedItemClicked)="panToUserMarker($event)" (storyItemClicked)="showStoryModal($event)" [progress]=progress></app-feed>
					   </div>
					   <div class="SlideshowSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'leaderboard'}">
							<app-tag-select *ngIf="hasEntryTags && !isHybrid" [raceID]="raceID" [tagType]="entryTagType" [hasAll]="true" [title]="'Filter by Org'" (emitState)="setLeaderboardTagID($event)"></app-tag-select>
							<app-route-select *ngIf="isHybrid && childRaceData.length > 0" [routes]="childRaceData" [title]="'Filter by Route'" (routeChanged)="setLeaderboardRouteFilter($event)"></app-route-select>
							<button class="whiteButton"  *ngIf="isHybrid && childRaceData.length > 0" (click)="openModal('route-info')">What does this mean?</button>

							<app-leaderboard *ngIf="!isHybrid && selectedTagFilterID != 0" [raceID]="raceID" [use]="'individual'" [allowFollow]="false" [tagID]="selectedTagFilterID"></app-leaderboard>
							<app-leaderboard *ngIf="selectedTagFilterID != 0 && raceSettings.allowTeams" [raceID]="raceID" [use]="'teams'" [allowFollow]="false" [tagID]="selectedTagFilterID"></app-leaderboard>
							<app-hybrid-leaderboard *ngIf="isHybrid" [raceID]="leaderboardRouteFilter.id"></app-hybrid-leaderboard>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class='MapGreaterContainer'>
			<app-map [raceIDs]="raceIDs" [displayUsers]="true" [followedIDs]="followedIDs" [zoom]="false"></app-map>
			<div class="buttonContainer">
				<button *ngIf="isOpen" (click)="toggleMenu()"><span class="material-icons">keyboard_arrow_left</span></button>
				<button *ngIf="!isOpen" (click)="toggleMenu()"><span class="material-icons">keyboard_arrow_right</span></button>
			</div>
		</div>
	</div>
</div>

<!-----STORY MODAL-->
<app-story-modal></app-story-modal>