<div class='TucanContainer'> 
	<!--<app-loader [isActive]="loading"></app-loader>-->
	<div class="MapContainer">

		<div class="MapSidebar" [ngClass]="{MapSidebarWidthBig: isOpen, MapSidebarWidthSmall: !isOpen}">
			<div class="MapHeaderContainer">
				<h3 class="MapHeaderTitle">{{this.raceName}}</h3>
				<div class='MapHeaderButtonsContainer'>
					<button (click)="viewAbout()">ABOUT</button>
					<button class="lightButton" *ngIf="this._authService.isLoggedIn() && this.userRegistered" (click)="openModal('mapSettingsModal')"><span class="material-icons">settings</span></button>
				</div>
			</div>

			<button  class='LogContainer' *ngIf="this._authService.isLoggedIn() && this.userRegistered" (click)="openModal('custom-modal-5')" >LOG ACTIVITY </button>

			<div class='MapActionsContainer' *ngIf="!this._authService.isLoggedIn() || !this.userRegistered">
					<p class='color-white'>Join the race and become a participant!</p>
					<button class="lightButton wideButton" (click)="viewAbout()">JOIN</button>
			</div>

<!--
			<div class='MapActionsContainer'>
				<ng-template [ngIf]="this._authService.isLoggedIn() && this.userRegistered" [ngIfElse]="NotLoggedInBlock">
					<button class="lightButton wideButton" (click)="openModal('custom-modal-5')" >LOG ACTIVITY</button>
				</ng-template>
				<ng-template #NotLoggedInBlock>
					<p class='color-white'>Join the race and become a participant!</p>
					<button class="lightButton wideButton" (click)="viewAbout()">JOIN</button>
				</ng-template>
			</div>
 -->
			<!--
			<div class='MapActionsContainer'  *ngIf="this._authService.isLoggedIn() && this.userRegistered && num_activities>0" matBadge="{{num_activities}}"  matBadgePosition="after" matBadgeColor="accent" (click)="openModal('custom-modal-5')" >LOG ACTIVITY</div> -->
			
			

			<div class="Slideshow MapFeedContainer">
				<div class="SlideshowHeader MapFeedSlideshowHeader">
					<button class="SlideshowButton" (click)="SwitchSlideshow('feed')" id="feed-btn">Social Feed</button>
					<button class="SlideshowButton" (click)="SwitchSlideshow('leaderboard')" id="leaderboard-btn">Leaderboard</button>
				</div>
				<div class="SlideshowContents MapFeedSlideshowContents">
						
						<div class="SlideshowSlide MapFeedSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'feed'}">
							<div *ngIf="this._authService.isLoggedIn()" class="MapFeedInputContainer">
								<div class="MapFeedInputProfileContainer">
									<img class='MapFeedInputProfile' src="{{userData.profile_url}}" alt='Your Profile Picture'>
								</div>
								<div class='MapFeedInputTextContainer'>
									<app-story-form  [raceID]="raceID" (logActivityEvent)="logActivity($event)" (storyPostedEvent)="newStoryPosted($event)"></app-story-form>
								</div>
							</div>
							<div class='MapFeedMainContainer'>
								<div class='MapFeedSettingsButtonContainer'>
									<div class='MapFeedSettingsContainer'>
										<button class="strippedWhite" (click)="toggleOptions()"><span class="material-icons">filter_list</span></button>
										<div *ngIf="feedOptions" class='MapFeedOptionsContainer'>
											Only show people I follow
											<input type="checkbox" [(ngModel)]="followerFeedOnly" [ngModelOptions]="{standalone: true}"/>
											<br>
											Only show stories
											<input type="checkbox" [(ngModel)]="storyFeedOnly" [ngModelOptions]="{standalone: true}"/>
										</div>
									</div>
								</div>
								<div class='MapFeed'>
									<app-feed [use]="'race'" [ID]="raceID" [hasStoryModalChild]="false" [followOnly]="followerFeedOnly" [storyOnly]="storyFeedOnly" (feedItemClicked)="panToUserMarker($event)" (storyItemClicked)="showStoryModal($event)" [progress]=progress></app-feed>
								</div>	
							</div>
						</div>
						
						<div class="SlideshowSlide MapLeaderboardSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'leaderboard'}">
							<app-tag-select *ngIf="hasEntryTags && !isHybrid" [raceID]="raceID" [tagType]="entryTagType" [hasAll]="true" [title]="'Filter by Org'" (emitState)="setLeaderboardTagID($event)"></app-tag-select>
							<app-route-select *ngIf="isHybrid && childRaceData.length > 0" [routes]="childRaceData" [title]="'Filter by Route'" (routeChanged)="setLeaderboardRouteFilter($event)"></app-route-select>
							<button class="whiteButton"  *ngIf="isHybrid && childRaceData.length > 0" (click)="openModal('route-info')">What does this mean?</button>

							<app-leaderboard *ngIf="!isHybrid && selectedTagFilterID != 0" [raceID]="raceID" [use]="'individual'" [allowFollow]="false" [tagID]="selectedTagFilterID"></app-leaderboard>
							<app-leaderboard *ngIf="selectedTagFilterID != 0 && raceSettings.allowTeams" [raceID]="raceID" [use]="'teams'" [allowFollow]="false" [tagID]="selectedTagFilterID"></app-leaderboard>
							<app-hybrid-leaderboard *ngIf="isHybrid" [raceID]="leaderboardRouteFilter.id"></app-hybrid-leaderboard>
						</div>

				</div>
			</div>
		</div>
		<div class='MapGreaterContainer'>
			<app-map [raceIDs]="raceIDs" [displayUsers]="true" [followedIDs]="followedIDs" [zoom]="false"></app-map>
			<div class="searchContainer"  *ngIf="this._authService.isLoggedIn() && this.userRegistered">
				<app-search [raceID]="raceID"></app-search>
			</div>
			<div class="buttonContainer">
				<button *ngIf="isOpen" (click)="toggleMenu()"><span class="material-icons">keyboard_arrow_left</span></button>
				<button *ngIf="!isOpen" (click)="toggleMenu()"><span class="material-icons">keyboard_arrow_right</span></button>
			</div>
		</div>
	</div>
</div>

<!-----STORY MODAL-->
<app-story-modal></app-story-modal>