<div *ngIf="!showEdit" class='UserProfileContainer'>
  
  <!-- user profile info -->
  <div class="UserProfileUserInfoContainer">
    <div class="TucanContainer UserProfileUserInfoInnerContainer">
      <div *ngIf="userData != null; else profileLoadingMessage">
        <img class="UserProfileImage img-responsive" src="{{userData.profile_url}}" alt=""> 
        <h3>{{userData.first_name}} {{userData.last_name}}</h3>
        <p *ngIf="userData.email_visibility||userData.is_me">{{ userData.email }}</p>

        <div *ngIf="userData.about_visibility||userData.location_visibility||userData.is_me">
          <h6>About:</h6>
          <div>
            <p *ngIf="userData.about_visibility && userData.description!='N/A'; else descriptionDefault">{{ userData.description }}</p> 
            <ng-template #descriptionDefault>No description available</ng-template>
          </div>
          <div>
            <p *ngIf="userData.location_visibility && userData.location != 'N/A'; else locationDefault">{{ userData.location }}</p>  
            <ng-template #locationDefault>No location info available</ng-template>
          </div>
        </div>

        <div *ngIf="this._authService.isLoggedIn()">
          <div *ngIf="userData.is_me">
            <app-view-follow></app-view-follow>
            <div>
              <h6>Strava Authentication</h6>
              <app-stravauth></app-stravauth>
            </div>
          </div>
        </div>
        <div *ngIf="!userData.is_me">
          <app-user-follow [userID]="userData.user_id" [follows]="userData.follows"></app-user-follow>
        </div>

        <!--
        <div *ngIf="userData.location_visibility||userData.is_me">
          <h6>Location:</h6>
          <p *ngIf="userData.location != 'N/A'; else locationDefault">{{ userData.location }}</p>  
          <ng-template #locationDefault>No location info available</ng-template>
        </div>
      -->
      </div>
      <ng-template #profileLoadingMessage><p>Loading...</p></ng-template>

      <div *ngIf="userData != null && this._authService.isLoggedIn()">
        <div *ngIf="userData.is_me">
          <a class="btn" (click)="toggleEditView()">EDIT</a>
          <a class="btn" (click)="logout()">Log out</a>
        </div>
      </div>

    </div>
  </div>
  <div class="UserProfileMainContentContainer">

    <div class="Slideshow">
      <div class="SlideshowHeader">
        <button class="SlideshowButton" (click)="SwitchSlideshow('stats')">Stats</button>
        <button *ngIf="!showEdit" class="SlideshowButton" (click)="SwitchSlideshow('feed')">Feed</button>
        <button class="SlideshowButton" (click)="SwitchSlideshow('races')">Races</button>
      </div>
      <div class="SlideshowContents">
        <div id='statsContent' class="SlideshowSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'stats'}">
          <div *ngIf="userData != null; else StatsLoadingMessage">
            <h2 *ngIf="userData.is_me; else otherUserStats">Your Stats</h2>
            <ng-template #otherUserStats><h2>{{userData.first_name}}'s Stats</h2></ng-template>
            <app-user-stats [userID]="userData.user_id"></app-user-stats>
          </div>
          <ng-template #StatsLoadingMessage><p>Retrieving user data...</p></ng-template>
        </div>
        <div *ngIf="!showEdit" id='feedContent' class="SlideshowSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'feed'}">
          <div *ngIf="userData != null; else FeedLoadingMessage">
            <h2 *ngIf="userData.is_me; else otherUserFeed">Your Feed</h2>
            <ng-template #otherUserFeed><h2>{{userData.first_name}}'s Feed</h2></ng-template>
            <app-feed [use]="'user'" [ID]="username" [hasStoryModalChild]="true"></app-feed>
          </div>
          <ng-template #FeedLoadingMessage><p>Retrieving user data...</p></ng-template>
        </div>
        <div id='raceContent' class="SlideshowSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'races'}">
          <div *ngIf="userData != null; else RaceLoadingMessage">
            <h2 *ngIf="userData.is_me; else otherUserRaces">Your Races</h2>
            <ng-template #otherUserRaces><h2>{{userData.first_name}}'s Races</h2></ng-template>
            <div *ngIf="userRaces==null"></div>
            <div *ngIf="userRaces!=null&&userRaces.length>0; else noRacesDisplay">
              <div *ngFor="let race of userRaces">
                <div *ngIf="userRaces.length>0 &&this._authService.isLoggedIn()">  
                  <h3>Race Type:</h3>
                  <div *ngIf="race.race_type == 1">
                    <i class="material-icons" style="color:#BC164D;">directions_run</i> 
                  </div>
                  <div *ngIf="race.race_type == 2">
                    <i class="material-icons" style="color:#BC164D;">directions_bike</i> 
                  </div>
                  <div *ngIf="race.race_type == 3">
                    <i class="material-icons" style="color:#BC164D;">directions_run</i> <i class="material-icons" style="color:#BC164D;">directions_bike</i> 
                  </div>
                  <h3 >Race img:</h3>
                  <img mat-card-image style="width: 255px;" src="{{race.race_image}}" alt="Race">
                  <h3>Start Location:</h3>
                  <p>{{race.start_loc}}</p>
                  <h3>End Location:</h3>
                  <p>{{race.end_loc}}</p>
                  <h3>Start Date:</h3>
                  <p>{{race.start_date}}</p>
                  <h3>End Date:</h3>
                  <p>{{race.end_date}}</p>
                  <h3>Distance:</h3>
                  <p>{{race.distance}}</p>
                  <a class="btn"(click)="viewRace(race)" *ngIf="race.has_started">GO TO RACE</a>
                  <p *ngIf="!race.has_started">Come back on race day ({{race.start_date}})! </p>
                  <a class="btn" (click)="viewAbout(race)">ABOUT RACE</a>
                </div>
              </div>
            </div>
            <ng-template #noRacesDisplay><p>You currently do not have any races under your belt. To find races you may be interested in, head over to <a routerLink='/races'>Public Races</a>.</p></ng-template>
          </div>
          <ng-template #RaceLoadingMessage><p>Loading user data...</p></ng-template>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showEdit">
  <app-profile-form  [userData]="userData" (formUpdated)="profileUpdated($event)"></app-profile-form>
</div>