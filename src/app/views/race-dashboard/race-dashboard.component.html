<div class="PageContainer DashboardContainer ">

  <ng-template [ngIf]="this.authService.isLoggedIn()" [ngIfElse]="MustLogIn">
    <!-- we produce a loading screen if either 1) both our navigation and content is loading, or 2) we're collecting race data -->
    <ng-template [ngIf]="this.loadingSegments.navigation && this.loadingSegments.content" [ngIfElse]="DataLayer">
      <div class="DashboardInitialization">
        <h2>Loading...</h2>
      </div>
    </ng-template>
  
    <ng-template #DataLayer>
      <ng-template [ngIf]="this.raceData == null" [ngIfElse]="MainView">
        <div class="DashboardInitialization">
          <div class="mustLogInContainer">
            <div class="mustLogInNotice">
              <!-- 
                if our race data is null, we gotta mention why. Either 
                1) No race ID was provided
                2) we're not the owner, 
                3) we're the owner but the data isn't loaded
              -->
              <ng-template [ngIf]="this.loadingSegments.content" [ngIfElse]="RaceLoaded">
                <h2>Loading...</h2>
              </ng-template>
              <ng-template #RaceLoaded>
                <ng-template [ngIf]="this.raceID == null" [ngIfElse]="RaceIdExists">
                  <h2>Error: Missing Race ID</h2>
                  <p>No Race ID has been provided. This prevents us from accessing the necessary race data information.</p>
                  <p>Please return to your profile and attempt to access the race dashboard for your race from there.</p>
                  <div class="mustLogInButtons">
                    <button (click)="this.navigateTo('profile');">Return to Profile</button>
                  </div>
                </ng-template>
                <ng-template #RaceIdExists>
                  <ng-template [ngIf]="!this.isOwnerOrMod" [ngIfElse]="IsOwnerOrMod">
                    <h2>Error: Not Owner Or Moderator</h2>
                    <p>You are not the owner of the race you are trying to access.</p>
                    <p>Please navigate to a different page or contact the owner of the race for more information.</p>
                    <div class="mustLogInButtons">
                      <button (click)="this.navigateTo('profile');">Return to Profile</button>
                    </div>
                  </ng-template>
                  <ng-template #IsOwnerOrMod>
                    <p>No race data found. Please either click the button prompt below or reload the page.</p>
                    <div class="mustLogInButtons">
                      <button (click)="this.reloadData();">Reload Data</button>
                    </div>
                  </ng-template>
                </ng-template>
              </ng-template>
            </div>
          </div>
        </div>
      </ng-template>
      <ng-template #MainView>
        <div class="DashboardNavigation" *ngIf="!this.loadingSegments.navigation">
          <div>
            <h1 class="RaceName">{{this.raceData.basics.name}}</h1>
            <ul class="DashboardNavigationList">
              <li class="DashboardNavigationItem dropdownContainer" [ngClass]="{'selected':this.page=='admin'}">
                <div class='dropdownHeader'>
                  <h6 class="margin-bottom-0px" (click)="this.navigateToDashboardPage('admin')">Admin</h6>
                </div>
              </li>
              <li class="DashboardNavigationItem dropdownContainer" [ngClass]="{'open':this.openedNavItem=='basics','selected':this.page=='basics'}">
                <div class="dropdownHeader">
                  <h6 class="margin-bottom-0px" (click)="this.navigateToDashboardPage('basics')">Race Basics <span class="exclamation-icon" *ngIf="!this.raceData.basics.valid_status.all"></span></h6>
                  <div class="dropdownToggle" (click)="this.openNavItemContents($event, 'basics')"></div>
                </div>
                <ul class='dropdownContent DashboardNavigationSubItem'>
                  <li class="DashboardNavigationSubItemRow">
                    <span>Name <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.basics.valid_status.name}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>Description <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.basics.valid_status.description}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>Start Date <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.basics.valid_status.startDate}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>End Date <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.basics.valid_status.endDate}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>Race Type <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.basics.valid_status.raceType}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>Banner Image</span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.basics.valid_status.bannerFile}"></div>
                  </li>
                </ul>
              </li>
              <li class="DashboardNavigationItem dropdownContainer" [ngClass]="{'open':this.openedNavItem=='map','selected':this.page=='map'}">
                <div class="dropdownHeader">
                  <h6 class="margin-bottom-0px" (click)="this.navigateToDashboardPage('map')">Map &amp; Route <span class="exclamation-icon" *ngIf="!this.raceData.map.valid_status.all"></span></h6>
                  <div class="dropdownToggle" (click)="this.openNavItemContents($event, 'map')"></div>
                </div>
                <ul class="dropdownContent DashboardNavigationSubItem">
                  <li class="DashboardNavigationSubItemRow">
                    <span>Start Location <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.map.valid_status.start_loc}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>Start Coordinates (Lat &amp; Lon) <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.map.valid_status.start_coords}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>End Location <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.map.valid_status.end_loc}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>End Coordinates (Lat &amp; Lon) <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.map.valid_status.end_coords}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>Map Route <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.map.valid_status.valid_route_file}"></div>
                  </li>
                </ul>
              </li>
              <li class="DashboardNavigationItem dropdownContainer" [ngClass]="{'open':this.openedNavItem=='merchandise','selected':this.page=='merchandise'}" >
                <div class='dropdownHeader'>
                  <h6 class="margin-bottom-0px" (click)="this.navigateToDashboardPage('merchandise')">Fees &amp; Merchandise <span class="exclamation-icon" *ngIf="!this.raceData.merchandise.valid_status.all"></span></h6>
                  <div class="dropdownToggle" (click)="this.openNavItemContents($event, 'merchandise')"></div>
                </div>
                <ul class="dropdownContent DashboardNavigationSubItem">
                  <li class="DashboardNavigationSubItemRow">
                    <span>Registration Fees <span class='redText'>*</span></span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.merchandise.valid_status.entries}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    <span>Merchandise</span>
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.merchandise.valid_status.merchandise}"></div>
                  </li>
                </ul>
              </li>
              <li class="DashboardNavigationItem dropdownContainer" [ngClass]="{'open':this.openedNavItem=='settings','selected':this.page=='settings'}">
                <div class="dropdownHeader">
                  <h6 class="margin-bottom-0px" (click)="this.navigateToDashboardPage('settings')">Settings</h6>
                  <div class="dropdownToggle" (click)="this.openNavItemContents($event, 'settings')"></div>
                </div>
                <ul class="dropdownContent DashboardNavigationSubItem">
                  <li class="DashboardNavigationSubItemRow">
                    Allow Teams
                    <div class="DashboardNavigationSubItemRowStatusIcon status-icon" [ngClass]="{'valid':this.raceData.settings.allow_teams}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow" [ngClass]="{'disabled':!this.raceData.settings.allow_teams}">
                    Max Team Size
                    <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.settings.allow_teams && this.raceData.settings.max_team_size > 0)}"></div>
                  </li>
                  <li class="DashboardNavigationSubItemRow">
                    Allow Manual Entries
                    <div class="DashboardNavigationSubItemRowStatusIcon status-icon" [ngClass]="{'valid':this.raceData.settings.is_manual_entry}"></div>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
          <div>
            <h4>Status: <span class="publicStatus" [ngClass]="{'isPublic':this.raceData.public}">{{this.getRaceStatus()}}</span></h4>
            <div class='dropdownContainer' [ngClass]="{'open':this.openedPublicChecklist}">
              <div class='dropdownHeader' (click)="this.togglePublicChecklist($event)">
                <p class="margin-bottom-0px">Public Race Checklist <span class="exclamation-icon" *ngIf="!this.racePublicValid"></span></p>
                <div class='dropdownToggle'></div>
              </div>
              <ul class='dropdownContent DashboardNavigationSubItem'>
                <li class='DashboardNavigationSubItemRow italics margin-bottom-8px'>
                  To publicize a race, the three required qualities of a race listed below must be satisfied.
                </li>
                <li class="DashboardNavigationSubItemRow">
                  <span>Race Basics</span>
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.basics.valid_status.all}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  <span>Map &amp; Route</span>
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.map.valid_status.all}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  <span>Fees &amp; Merch</span>
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.merchandise.valid_status.all}"></div>
                </li>
              </ul>
            </div>
            <div class='formGroup margin-bottom-0px'>
              <div class='formInputContainer'>
                <button 
                  class='formButton formSubmitButton width-100per' 
                  [ngClass]="{'disabled':!this.racePublicValid}"
                  [disabled]="!this.racePublicValid"
                  (click)="this.toggleRacePublicStatus($event)"
                >{{this.getRaceStatusToggle()}}
                </button>
              </div>
            </div>
          </div>
        </div>
        <ng-template [ngIf]="this.loadingSegments.content" [ngIfElse]="RaceDashboardContents">
          <div class="DashboardContents">
            <h2>Loading...</h2>
          </div>
        </ng-template>
        <ng-template #RaceDashboardContents>
          <div class="DashboardContents" [ngSwitch]="this.page">
            <p *ngSwitchCase="'admin'">Admin</p>
            <div *ngSwitchCase="'basics'">
              <app-race-basics [raceID]="this.raceID" [raceData]="this.raceData.basics" [loadedCallback]="this.saveCurrentPageRef" [getRaceDataCallback]="this.getRaceData"></app-race-basics>
            </div>
            <div *ngSwitchCase="'settings'">
              <app-race-settings [raceID]="this.raceID" [raceData]="this.raceData.settings" [loadedCallback]="this.saveCurrentPageRef" [getRaceDataCallback]="this.getRaceData"></app-race-settings>
            </div>
            <div *ngSwitchCase="'map'">
              <app-race-map-settings [raceID]="this.raceID" [raceData]="this.raceData.map" [loadedCallback]="this.saveCurrentPageRef" [getRaceDataCallback]="this.getRaceData"></app-race-map-settings>
            </div>
            <div *ngSwitchCase="'merchandise'">
              <app-race-merchandise-settings [raceID]="this.raceID" [raceData]="this.raceData.merchandise" [loadedCallback]="this.saveCurrentPageRef" [getRaceDataCallback]="this.getRaceData"></app-race-merchandise-settings>
            </div>
          </div>
        </ng-template>
        <!--
        <h1>{{ this.raceName }} Dashboard</h1>
      
        <div *ngIf="this.childRaceData.length > 1">
          <div class="container">
            <label>Select Route</label>
            <select [(ngModel)]="selectedRaceID">
              <option *ngFor="let x of this.childRaceData" [value]="x.id" [selected]="selectedRaceID == x.id">{{x.name}}</option>
            </select>
          </div>
        </div>
        -->
      
        <!-- List of racers in this race -->
        <!--
        <app-race-dashboard-racer-list [raceID]="selectedRaceID" [raceName]="selectedRaceName"></app-race-dashboard-racer-list>
        -->
      
        <!-- Manage reported stories -->
        <!--
        <app-race-story-manage [raceID]="raceID"></app-race-story-manage>
        -->
      </ng-template>
    </ng-template>
  </ng-template>

  <ng-template #MustLogIn>
    <div class="mustLogInContainer">
      <div class="mustLogInNotice">
        <p>You must be logged in to access the Race Creation Dashboard. Please either log into or sign up for a Tucan Fitness account.</p>
        <div class="mustLogInButtons">
          <button (click)="this.openLogin();">Log In</button>
          <button (click)="this.openRegister();">Sign Up</button>
        </div>
      </div>
    </div>
  </ng-template>
</div>