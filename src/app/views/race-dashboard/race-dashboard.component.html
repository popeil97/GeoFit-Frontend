<div class="PageContainer DashboardContainer ">

  <ng-template [ngIf]="this.authService.isLoggedIn()" [ngIfElse]="MustLogIn">
    <!-- we produce a loading screen if either 1) both our navigation and content is loading, or 2) we're collecting race data -->
    <ng-template [ngIf]="this.loadingSegments.navigation && this.loadingSegments.content" [ngIfElse]="DataLayer">
      <div class="DashboardInitialization">
        <h2>Loading...</h2>
      </div>
    </ng-template>
  
    <ng-template #DataLayer>
      <ng-template [ngIf]="this.raceData == null" [ngIfElse]="MainView">
        <div class="DashboardInitialization">
          <div class="mustLogInContainer">
            <div class="mustLogInNotice">
              <!-- 
                if our race data is null, we gotta mention why. Either 
                1) No race ID was provided
                2) we're not the owner, 
                3) we're the owner but the data isn't loaded
              -->
              <ng-template [ngIf]="this.loadingSegments.content" [ngIfElse]="RaceLoaded">
                <h2>Loading...</h2>
              </ng-template>
              <ng-template #RaceLoaded>
                <ng-template [ngIf]="this.raceID == null" [ngIfElse]="RaceIdExists">
                  <h2>Error: Missing Race ID</h2>
                  <p>No Race ID has been provided. This prevents us from accessing the necessary race data information.</p>
                  <p>Please return to your profile and attempt to access the race dashboard for your race from there.</p>
                  <div class="mustLogInButtons">
                    <button (click)="this.navigateTo('profile');">Return to Profile</button>
                  </div>
                </ng-template>
                <ng-template #RaceIdExists>
                  <ng-template [ngIf]="!this.isOwnerOrMod" [ngIfElse]="IsOwnerOrMod">
                    <h2>Error: Not Owner Or Moderator</h2>
                    <p>You are not the owner of the race you are trying to access.</p>
                    <p>Please navigate to a different page or contact the owner of the race for more information.</p>
                    <div class="mustLogInButtons">
                      <button (click)="this.navigateTo('profile');">Return to Profile</button>
                    </div>
                  </ng-template>
                  <ng-template #IsOwnerOrMod>
                    <p>No race data found. Please either click the button prompt below or reload the page.</p>
                    <div class="mustLogInButtons">
                      <button (click)="this.reloadData();">Reload Data</button>
                    </div>
                  </ng-template>
                </ng-template>
              </ng-template>
            </div>
          </div>
        </div>
      </ng-template>
      <ng-template #MainView>
        <div class="DashboardNavigation" *ngIf="!this.loadingSegments.navigation">
          <h1 class="RaceName">{{this.raceData.basics.name}}</h1>
          <ul class="DashboardNavigationList">
            <li class="DashboardNavigationItem" (click)="this.navigateToAdmin();">
              <h6 class="margin-bottom-0px">Admin</h6>
            </li>
            <li class="DashboardNavigationItem" [ngClass]="{'opened':this.openedNavItem=='basics','selected':this.page=='basics'}" (click)="this.navigateToRaceBasics();">
              <h6 class="margin-bottom-0px position-relative">
                Race Basics
                <div class="DashboardNavigationItemDropdownIndicator" (click)="this.openNavItemContents($event, 'basics')"></div>
              </h6>
              <ul class="DashboardNavigationSubItem" *ngIf="this.raceData != null">
                <li class="DashboardNavigationSubItemRow">
                  Name
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.basics.name != null && this.raceData.basics.name.length > 0)}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  Description
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.basics.description != null && this.raceData.basics.description.length > 0)}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  Start Date
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.basics.startDate != null && this.raceData.basics.startDate.length > 0)}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  End Date
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.basics.endDate != null && this.raceData.basics.endDate.length > 0)}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  Banner Image
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.basics.bannerFile != null}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  Race Type
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.basics.raceType !+ null}"></div>
                </li>
              </ul>
            </li>
            <li class="DashboardNavigationItem" [ngClass]="{'opened':this.openedNavItem=='settings','selected':this.page=='settings'}" (click)="this.navigateToSettings();">
              <h6 class="margin-bottom-0px position-relative">
                Settings
                <div class="DashboardNavigationItemDropdownIndicator" (click)="this.openNavItemContents($event, 'settings')"></div>
              </h6>
              <ul class="DashboardNavigationSubItem" *ngIf="this.raceData != null">
                <li class="DashboardNavigationSubItemRow">
                  Allow Teams
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.settings.allow_teams}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow" [ngClass]="{'disabled':!this.raceData.settings.allow_teams}">
                  Max Team Size
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.settings.allow_teams && this.raceData.settings.max_team_size > 0)}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  Allow Manual Entries
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.settings.is_manual_entry}"></div>
                </li>
              </ul>
            </li>
            <li class="DashboardNavigationItem" [ngClass]="{'opened':this.openedNavItem=='map','selected':this.page=='map'}"  (click)="this.navigateToMap();">
              <h6 class="margin-bottom-0px position-relative">
                Map &amp; Route
                <div class="DashboardNavigationItemDropdownIndicator" (click)="this.openNavItemContents($event, 'map')"></div>
              </h6>
              <ul class="DashboardNavigationSubItem" *ngIf="this.raceData != null">
                <li class="DashboardNavigationSubItemRow">
                  Start Location
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.map.start_loc != null && this.raceData.map.start_loc.length > 0)}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  Start Coordinates (Lat &amp; Lon)
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.map.start_lat != null && this.raceData.map.start_lon != null)}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  End Location
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.map.end_loc != null && this.raceData.map.end_loc.length > 0)}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  End Coordinates (Lat &amp; Lon)
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':(this.raceData.map.end_lat != null && this.raceData.map.end_lon != null)}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  Map Route
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.map.valid_route_file}"></div>
                </li>
              </ul>
            </li>
            <li class="DashboardNavigationItem" [ngClass]="{'opened':this.openedNavItem=='merchandise','selected':this.page=='merchandise'}"  (click)="this.navigateToMerchandise();">
              <h6 class="margin-bottom-0px position-relative">
                Merchandise &amp; Fees
                <div class="DashboardNavigationItemDropdownIndicator" (click)="this.openNavItemContents($event, 'merchandise')"></div>
              </h6>
              <ul class="DashboardNavigationSubItem" *ngIf="this.raceData != null">
                <li class="DashboardNavigationSubItemRow">
                  Merchandise
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.merchandise.merchandise.length > 0}"></div>
                </li>
                <li class="DashboardNavigationSubItemRow">
                  Registration Fees
                  <div class="DashboardNavigationSubItemRowStatusIcon checkmark-icon" [ngClass]="{'valid':this.raceData.merchandise.entries.length > 0}"></div>
                </li>
              </ul>
            </li>
          </ul>
        </div>
        <ng-template [ngIf]="this.loadingSegments.content" [ngIfElse]="RaceDashboardContents">
          <div class="DashboardContents">
            <h2>Loading...</h2>
          </div>
        </ng-template>
        <ng-template #RaceDashboardContents>
          <div class="DashboardContents" [ngSwitch]="this.page">
            <p *ngSwitchCase="'admin'">Admin</p>
            <div *ngSwitchCase="'basics'">
              <app-race-basics [raceID]="this.raceID" [raceData]="this.raceData.basics" [getRaceDataCallback]="this.getRaceData"></app-race-basics>
            </div>
            <div *ngSwitchCase="'settings'">
              <app-race-settings [raceID]="this.raceID" [raceData]="this.raceData.settings" [getRaceDataCallback]="this.getRaceData"></app-race-settings>
            </div>
            <div *ngSwitchCase="'map'">
              <app-race-map-settings [raceID]="this.raceID" [raceData]="this.raceData.map" [getRaceDataCallback]="this.getRaceData"></app-race-map-settings>
            </div>
            <div *ngSwitchCase="'merchandise'">
              <app-race-merchandise-settings [raceID]="this.raceID" [raceData]="this.raceData.merchandise" [getRaceDataCallback]="this.getRaceData"></app-race-merchandise-settings>
            </div>
          </div>
        </ng-template>
        <!--
        <h1>{{ this.raceName }} Dashboard</h1>
      
        <div *ngIf="this.childRaceData.length > 1">
          <div class="container">
            <label>Select Route</label>
            <select [(ngModel)]="selectedRaceID">
              <option *ngFor="let x of this.childRaceData" [value]="x.id" [selected]="selectedRaceID == x.id">{{x.name}}</option>
            </select>
          </div>
        </div>
        -->
      
        <!-- List of racers in this race -->
        <!--
        <app-race-dashboard-racer-list [raceID]="selectedRaceID" [raceName]="selectedRaceName"></app-race-dashboard-racer-list>
        -->
      
        <!-- Manage reported stories -->
        <!--
        <app-race-story-manage [raceID]="raceID"></app-race-story-manage>
        -->
      </ng-template>
    </ng-template>
  </ng-template>

  <ng-template #MustLogIn>
    <div class="mustLogInContainer">
      <div class="mustLogInNotice">
        <p>You must be logged in to access the Race Creation Dashboard. Please either log into or sign up for a Tucan Fitness account.</p>
        <div class="mustLogInButtons">
          <button (click)="this.openLogin();">Log In</button>
          <button (click)="this.openRegister();">Sign Up</button>
        </div>
      </div>
    </div>
  </ng-template>
</div>