<div class='TucanContainer'> 
	<div class="MapSidebar" [ngClass]="{'collapsed':!this.isOpen}">
		<div class="MapSidebarContainer">
			<div class="MapSidebarToggle" (click)="this.toggleSidebar()"></div>
			<div class="MapHeaderContainer">
				<h3 class="MapHeaderTitle">{{this.raceName}}</h3>
				<p class='a margin-bottom-0px margin-top-4px overflow-hidden' (click)="this.viewAbout()">More about this race</p>
			</div>
			<div class='MapActionsContainer'>
				<ng-template [ngIf]="(!this._authService.isLoggedIn() || !this.userRegistered)" [ngIfElse]="LogBlock">
					<p class='color-white margin-bottom-4px'>Join the race and become a participant!</p>
					<button class="lightButton wideButton" (click)="this.viewAbout()">JOIN</button>
				</ng-template>
				<ng-template #LogBlock>
					<button class='lightButton wideButton' (click)="this.openLogActivity()" >LOG ACTIVITY</button>
				</ng-template>
			</div>
			<div class="Slideshow MapFeedContainer"  *ngIf="isOpen">
				<div class="SlideshowHeader MapFeedSlideshowHeader" >
					<button class="SlideshowButton" (click)="SwitchSlideshow('feed')" id="feed-btn">Social Feed</button>
					<button class="SlideshowButton" (click)="SwitchSlideshow('leaderboard')" id="leaderboard-btn">Leaderboard</button>
					<button *ngIf="allowTeams" class="SlideshowButton" (click)="SwitchSlideshow('teams')" id="teams-btn">Teams</button>
				</div>
				<div class="SlideshowContents MapFeedSlideshowContents">
					<div class="SlideshowSlide MapFeedSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'feed'}">
						<div *ngIf="this._authService.isLoggedIn()" class="MapFeedInputContainer">
							<div class="MapFeedInputProfileContainer">
								<img class='MapFeedInputProfile' src="{{userData.profile_url}}" alt='Your Profile Picture'>
							</div>
							<div class='MapFeedInputTextContainer'>
								<app-story-form  [raceID]="raceID" (logActivityEvent)="logActivity($event)" (storyPostedEvent)="newStoryPosted($event)"></app-story-form>
							</div>
						</div>
						<div class='MapFeedSettingsButtonContainer'>
							<div class='MapFeedSettingsContainer'>
								<button class="strippedWhite h7" (click)="toggleOptions()">Filter Chat <span class="material-icons">filter_list</span></button>
								<div *ngIf="feedOptions" class='MapFeedOptionsContainer'>
									<p class="textControl">Only show people I follow <input type="checkbox" [(ngModel)]="followerFeedOnly" [ngModelOptions]="{standalone: true}"/></p>
									<p class="textControl">Only show status updates <input type="checkbox" [(ngModel)]="storyFeedOnly" [ngModelOptions]="{standalone: true}"/> </p>
								</div>
							</div>
						</div>
						<div class='MapFeed'>
							<app-feed [use]="'race'" [ID]="raceID" [hasStoryModalChild]="false" [followOnly]="followerFeedOnly" [storyOnly]="storyFeedOnly" (feedItemClicked)="panToUserMarker($event)" (storyItemClicked)="showStoryModal($event)" [progress]=progress></app-feed>
						</div>
					</div>		
					<div class="SlideshowSlide MapLeaderboardSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'leaderboard'}">
						<div class='LeaderboardFeed'>
							<app-tag-select *ngIf="hasEntryTags && !isHybrid" [raceID]="raceID" [tagType]="entryTagType" [hasAll]="true" [title]="'Filter by Org'" (emitState)="setLeaderboardTagID($event)"></app-tag-select>
							<div class="routeRow" *ngIf="isHybrid && childRaceData.length > 0">
								<div class="routeCol">
									<app-route-select  [routes]="childRaceData" [title]="'Filter by Route'" (routeChanged)="setLeaderboardRouteFilter($event)"></app-route-select>
								</div>
								<div class="qCol">
									<button class="whiteButton smallButton" (click)="this.openRouteInfo()">?</button>
								</div>
							</div>
								
							<div *ngIf="allowTeams" class="SlideshowHeader MapFeedSlideshowHeader">
								<button class="SlideshowButton" (click)="SwitchLeaderboard('individual')" id="individual-leaderboard-btn">Individual</button>
								<button class="SlideshowButton" (click)="SwitchLeaderboard('teams')" id="teams-leaderboard-btn">Teams</button>
							</div>
	
							<app-leaderboard *ngIf="!isHybrid && selectedTagFilterID != 0 && currentLeaderboard == 'individual'" [raceID]="raceID" [use]="'individual'" [allowFollow]="false" [tagID]="selectedTagFilterID"></app-leaderboard> 
							<app-leaderboard *ngIf="selectedTagFilterID != 0 && allowTeams && currentLeaderboard == 'teams'" [raceID]="raceID" [use]="'teams'" [allowFollow]="false" [tagID]="selectedTagFilterID"></app-leaderboard>
							<app-hybrid-leaderboard *ngIf="isHybrid && currentLeaderboard == 'individual'" [raceID]="leaderboardRouteFilter.id"></app-hybrid-leaderboard>
						</div>
					</div>
	
					<div class="SlideshowSlide MapLeaderboardSlide" [ngClass]="{'Slideshow-CurrentSlide' : currentScreen == 'teams'}">
						<app-team-list *ngIf="allowTeams" [race_id]="raceID" [userStat]="userStat" (callback)="refreshAllComponents($event)"></app-team-list>
					</div>
					
				</div>
			</div>
		</div>
	</div>
	<div class='MapGreaterContainer'>
		<app-map [raceIDs]="raceIDs" [parentRaceID]="raceID" [displayUsers]="true" [followedIDs]="followedIDs" [zoom]="false"></app-map>
		<div *ngIf="this._authService.isLoggedIn() && this.userRegistered"[ngClass]="{searchContainer: isOpen, searchContainerSmall: !isOpen}">
			<app-search [raceID]="raceID"></app-search>
		</div>
	</div>
</div>

<!-----STORY MODAL-->
<app-story-modal></app-story-modal>